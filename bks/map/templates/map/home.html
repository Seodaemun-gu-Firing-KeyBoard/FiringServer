<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>지도</title>
</head>

<body>
  <h1>네이버 지도API</h1>
  <form id="addressForm">
    <input type="text" id="addressInput" placeholder="주소를 입력하세요">
    <button type="submit">검색</button>
  </form>
  <button id="currentLocationButton">현재 위치 보기</button>
  <div id="map" style="width: 500px; height: 400px;"></div>

  <h1>경로 및 소요시간 확인</h1>
  <form id="routeForm">
    <label for="startInput">출발지:</label>
    <input type="text" id="startInput" placeholder="출발지를 입력하세요"><br>
    <label for="endInput">도착지:</label>
    <input type="text" id="endInput" placeholder="도착지를 입력하세요"><br>
    <button type="submit">경로 확인</button>
  </form>
  <div id="map2" style="width: 500px; height: 400px;"></div>
  <div id="routeInfo"></div>

  <h1>입력한 데이터 지도에 정보 띄우기</h1>
  <div id="map3" style="width: 500px; height: 400px;"></div>

  <script type="text/javascript"
    src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=2lhimp3vcd&submodules=geocoder,directions"></script>
  <script>
    const form = document.getElementById('addressForm');
    const addressInput = document.getElementById('addressInput');

    const routeform = document.getElementById('routeForm');
    const startInput = document.getElementById('startInput');
    const endInput = document.getElementById('endInput');

    const currentLocationButton = document.getElementById('currentLocationButton');

    const mapOptions = {
      center: new naver.maps.LatLng(37.580541, 126.922365),
      zoom: 17,
      mapTypeControl: true,
      zoomControl: true,
      scaleControl: true,
      mapDataControl: true,
    };

    var map = new naver.maps.Map('map', mapOptions);
    var map2 = new naver.maps.Map('map2', mapOptions);

    form.addEventListener('submit', function (event) {
      event.preventDefault();
      const address = addressInput.value;
      if (address.trim() === '') {
        alert('주소를 입력하세요.');
        return;
      }
      searchAddress(address);
    });

    function searchAddress(address) {

      naver.maps.Service.geocode({
        query: address
      }, function (status, response) {
        if (status === naver.maps.Service.Status.ERROR) {
          alert('주소 검색 실패: ' + response.message);
          return;
        }
        if (response.v2.meta.totalCount === 0) {
          alert('검색 결과가 없습니다.');
          return;
        }

        const result = response.v2.addresses[0];
        const point = new naver.maps.Point(result.x, result.y);
        const marker = new naver.maps.Marker({
          position: point,
          map: map,
        });

        map.setCenter(point);
        map.setZoom(17);


      })
    }

    currentLocationButton.addEventListener('click', function () {
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function (position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const currentPosition = new naver.maps.LatLng(lat, lng);
          const marker = new naver.maps.Marker({
            position: currentPosition,
            map: map,
          });
          map.setCenter(currentPosition);
          map.setZoom(17);
        }, function (error) {
          alert('현재 위치를 가져올 수 없습니다.');
        });
      } else {
        alert('브라우저가 위치 정보를 지원하지 않습니다.');
      }
    });

    routeform.addEventListener('submit', function (event) {
      event.preventDefault();
      const start = startInput.value;
      const end = endInput.value;
      if (start.trim() === '' || end.trim() === '') {
        alert('출발지와 도착지를 입력하세요.');
        return;
      }
      getRouteInfo(start, end);
    });

    function getRouteInfo(start, end) {
      naver.maps.Service.geocode({
        query: start
      }, function (startStatus, startResponse) {
        if (startStatus !== naver.maps.Service.Status.OK || startResponse.v2.meta.totalCount === 0) {
          alert('출발지 주소를 찾을 수 없습니다.');
          return;
        }

        naver.maps.Service.geocode({
          query: end
        }, function (endStatus, endResponse) {
          if (endStatus !== naver.maps.Service.Status.OK || endResponse.v2.meta.totalCount === 0) {
            alert('도착지 주소를 찾을 수 없습니다.');
            return;
          }

          const startResult = startResponse.v2.addresses[0];
          const endResult = endResponse.v2.addresses[0];
          const startCoord = new naver.maps.LatLng(startResult.y, startResult.x);
          const endCoord = new naver.maps.LatLng(endResult.y, endResult.x);

          naver.maps.Service.directions({
            start: startCoord,
            end: endCoord,
            options: {
              routeType: 'shortest'
            }
          }, function (status, response) {
            if (status === naver.maps.Service.Status.OK) {
              const routeInfo = response.result.routes[0];
              const duration = routeInfo.summary.duration.text;
              const distance = routeInfo.summary.distance.text;

              const routeText = `출발지: ${start}<br>도착지: ${end}<br>소요시간: ${duration}<br>거리: ${distance}`;
              const routeInfoDiv = document.getElementById('routeInfo');
              routeInfoDiv.innerHTML = routeText;

              const bounds = new naver.maps.LatLngBounds();
              bounds.extend(startCoord);
              bounds.extend(endCoord);
              map2.fitBounds(bounds);

              const path = routeInfo.path.map(coord => new naver.maps.LatLng(coord[1], coord[0]));
              const routePath = new naver.maps.Polyline({
                map: map2,
                path: path,
                strokeColor: '#f00',
                strokeWeight: 5,
              });
            } else {
              alert('경로를 찾을 수 없습니다.');
            }
          });
        });
      });
    }


    //[[[3번째 지도]]]
    var map3 = new naver.maps.Map('map3', mapOptions)

    fo
  </script>
</body>

</html>